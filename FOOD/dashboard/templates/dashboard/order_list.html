{% extends 'dashboard/base_dashboard.html' %}
{% block title %}Orders | FastEats{% endblock %}
{% block page_title %}Orders{% endblock %}

{% block content %}

<div class="card">
    <h3 style="margin-bottom: 1rem;">All Orders</h3>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Customer</th>
                    <th>Restaurant</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Rider</th>
                    <th>Actions</th>
                </tr>
            </thead>

            <tbody>
                {% for order in orders %}
                <tr>
                    <td>#{{ order.id }}</td>

                    <td>
                        {{ order.user.username }}
                    </td>

                    <td>
                        {{ order.restaurant.name }}
                    </td>

                    <td>
                        ৳{{ order.total_price }}
                    </td>

                    <td>
                        {% if order.status == 'delivered' %}
                        <span class="badge badge-success">Delivered</span>
                        {% elif order.status == 'cancelled' %}
                        <span class="badge badge-danger">Cancelled</span>
                        {% elif order.status == 'preparing' %}
                        <span class="badge badge-warning">Preparing</span>
                        {% else %}
                        <span class="badge badge-primary">{{ order.status|title }}</span>
                        {% endif %}
                    </td>

                    <td>
                        {% if order.rider %}
                            {{ order.rider.username }}
                        {% else %}
                            <span style="color:#94a3b8;">Not Assigned</span>
                        {% endif %}
                    </td>

                    <td>
                        {% if order.status != 'cancelled' and order.status != 'delivered' %}
                        <form action="{% url 'assign_rider' order.id %}" method="post"
                              style="display:flex; gap:6px; align-items:center;">
                            {% csrf_token %}

                            <select name="rider_id"
                                    style="padding:0.4rem; border-radius:6px; border:1px solid #e2e8f0; font-size:0.8125rem;">
                                <option value="">Rider...</option>

                                {% for rider in riders %}
                                <option value="{{ rider.id }}"
                                    {% if order.rider and order.rider.id == rider.id %}selected{% endif %}>
                                    {{ rider.username }}
                                </option>
                                {% endfor %}
                            </select>

                            <button type="submit"
                                    class="badge badge-primary"
                                    style="border:none; cursor:pointer; padding:0.5rem;">
                                Assign
                            </button>
                        </form>
                        {% else %}
                        <span style="color:#94a3b8;">—</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" style="text-align:center; padding:2rem; color:#94a3b8;">
                        No orders found
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}
